% Chapter 1

\chapter{Introducción general} % Main chapter title

\label{Chapter1} % For referencing the chapter elsewhere, use \ref{Chapter1} 
\label{IntroGeneral}

%----------------------------------------------------------------------------------------

% Define some commands to keep the formatting separated from the content 
\newcommand{\keyword}[1]{\textbf{#1}}
\newcommand{\tabhead}[1]{\textbf{#1}}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\file}[1]{\texttt{\bfseries#1}}
\newcommand{\option}[1]{\texttt{\itshape#1}}
\newcommand{\grados}{$^{\circ}$}

%----------------------------------------------------------------------------------------

%\section{Introducción}

%----------------------------------------------------------------------------------------

En este capítulo se presenta la problemática y la motivación que llevaron a la realización del presente trabajo.

\section{Descripción de la problemática}

La fenómica hace referencia a la obtención de un gran caudal de datos de las características de las plantas, lo que se denomina el fenotipo de la planta. Esta disciplina está en auge en la actualidad debido a sus aplicaciones potenciales. Por un lado, habilita el mejoramiento a gran escala debido a que es necesario vincular una gran cantidad de datos genéticos con datos fenotípicos para identificar la función de los genes. Por otro lado, si se incluyen otros conjuntos de datos como son los climáticos, permite realizar predicciones precisas sobre el comportamiento de las variedades, lo que es necesario para implementar lo que se conoce como agricultura de precisión. Sin embargo, la fruticultura no ha dado el salto hacia la fenómica.

En la  Estación Experimental Agropecuaria (EEA) de San Pedro se ha logrado secuenciar el ADN de más de 250 variedades de duraznero \cite{ARTICLE:1} y se dispone de una base de datos genómica de 75 gigabases (Gb) de ADN. Esta base permite identificar genes que controlan características del duraznero mediante algoritmos de inteligencia artificial (IA). Además, se dispone de datos climáticos diarios que se toman de forma automática que incluyen: las temperaturas medias, precipitaciones, horas de frío, radiación, etc. Esta información se combina con los datos genómicos y posteriormente, con modelos de IA, se predice el comportamiento de las variedades en escenarios climáticos futuros. En la figura \ref{fig:genotipado}, se observa el proceso para obtener los datos genómicos.

\begin{figure}[h]
	\centering
	\includegraphics[scale=.3]{./Figures/genotipado.png}
	\caption{Proceso para obtener los datos genómicos \cite{ARTICLE:1}.}
	\label{fig:genotipado}
\end{figure}
\newpage
En la actualidad, las heladas primaverales son el mayor problema de los frutales a nivel mundial. Este fenómeno ocurre cuando las flores abiertas se someten a temperaturas cercanas a los -2.5 °C. Las heladas primaverales tienen una temperatura parecida a cualquier otra helada que se puede presentar en la temporada de invierno. Sin embargo, estas heladas suelen presentarse después del invierno, creando un gran impacto contra las flores y los frutos. Los productores de frutas, en general, se ven altamente afectados pagando un alto precio por estas inesperadas heladas tardías. En la figura \ref{fig:helada}, se puede observar cómo este fenómeno meteorológico afecta a los frutales.

\begin{figure}[htpb]
	\centering
	\includegraphics[scale=.3]{./Figures/heladas3.jpeg}
	\caption{Frutales afectados por las heladas primaverales \cite{WEBSITE:1}.}
	\label{fig:helada}
\end{figure}

\section{Motivación}

Por lo explicado anteriormente, es del interés del Instituto Nacional de Tecnología Agropecuaria (INTA) determinar el estado fenológico a campo y mejorar la tolerancia a heladas primaverales.

Para determinar el estado fenológico a campo, es necesario conocer el número de flores que se encuentran en estado vulnerable ante un pronóstico de heladas primaverales, así como también la densidad de flores.

En cuanto al mejoramiento, se ha realizado una caracterización a gran escala de la tolerancia a heladas de la colección de duraznero con el objetivo de identificar los genes responsables. Parte de ese experimento consistió en registrar el estado fenológico mediante fotos.

El presente trabajo permitirá automatizar la toma de datos de varetas de duraznero a partir de fotos para aumentar el caudal de datos y mejorar los modelos de IA.

\section{Requerimientos}

\begin{enumerate}
	\item Requerimientos funcionales
		\begin{enumerate}
			\item El sistema tomará como entrada imágenes de varetas de durazneros en formato JPG.			
			\item El algoritmo debe detectar la presencia de las varetas de los durazneros e identificar el tipo de flor que posee.			        
			\item El algoritmo debe identificar el estado fenológico de cada flor de duraznero en la vareta. Este estado se clasificará como  \textit{flor abierta}, \textit{flor cerrada}, \textit{flor sinpetalos}, \textit{incierto}.
			\item El algoritmo debe determinar la cantidad de flores por centímetro de vareta.
			\item El sistema debe entregar como resultado un archivo en formato CSV con los datos detectados por el algoritmo y una imagen donde se puedan visualizar las detecciones.
			\item El sistema debe funcionar en una computadora local.
		\end{enumerate}
	\item Requerimientos de diseño e implementación
		\begin{enumerate}
			\item El diseño debe ser modular.
			\item El algoritmo se elaborará en una notebook de Google Colab, utilizando el lenguaje de  programación Python y bibliotecas de IA correspondientes. 
		\end{enumerate}
	\item Requerimiento de evaluación y prueba
	\begin{enumerate}
			\item El modelo se evaluará con imágenes provenientes del mismo dataset de imágenes entregado por el cliente.
			 \item La métrica que se utilizará para la evaluación del modelo de detección será \textit{mean average precision} (mAP) y para el clasificador se tomarán en cuenta las métricas \textit{accuracy}, \textit{precision} y \textit{recall}.
		\end{enumerate}
	\item Requerimientos de documentación
	\begin{enumerate}
			\item El funcionamiento del sistema debe estar correctamente explicado y documentado.
			 \item El código estará correctamente comentado como parte de buenas prácticas del desarrollo de software.
			 \item Inclusión de documentación en un repositorio, mediante un archivo README.md (opcional).
		\end{enumerate}
\end{enumerate}

\section{Objetivo y alcances}

El objetivo de este trabajo es desarrollar un algoritmo que permita automatizar la toma de datos de las flores de duraznero a través de fotos de varetas.

El presente trabajo incluye:
\begin{itemize}
	\item El preprocesamiento de las fotos para entrenar el modelo.
	\item La selección del modelo a entrenar.
	\item La elaboración del notebook de pruebas en Python.
	\item La implementación local del modelo.
\end{itemize}

El trabajo no incluye:
\begin{itemize}
	\item La recolección de datos/fotos.
	\item La integración con otros modelos que utilice el cliente.
\end{itemize}


%----------------------------------------------------------------------------------------

\section{Estado del arte}

El presente trabajo contiene distintos algoritmos que, integrados, logran tomar los datos deseados. Es por este motivo que para determinar el estado del arte es necesario desglosar cada algoritmo y evaluarlo individualmente como se hace a continuación.

\subsection{Medición de la vareta}

En la actualidad, se han desarrollado algoritmos que pueden determinar el tamaño de distintos objetos a través de imágenes usando visión por computadora. Muchos parten de encontrar un objeto de referencia al que se le conocen sus dimensiones (alto y ancho). Este objeto de referencia, normalmente se selecciona por ser fácil de detectar, por conocer sus dimensiones y por ser un objeto único. El procedimiento habitual para su detección, es pasar la imagen a escala de grises, aplicar filtros gaussianos para eliminar el ruido, utilizar detección de bordes y por último utilizar detección de contornos, tal y como se realiza en el trabajo \cite{ARTICLE:2}. Cabe destacar que usualmente el fondo es de un color blanco, lo que facilita la detección.

En el presente trabajo se tienen imágenes con fondos de color naranja en su mayoría, el objeto de referencia a veces se encuentra ocluido, las imágenes se encuentran en horizontal o vertical, el objeto de referencia no siempre tiene la misma posición, etc. Por estos motivos, se utilizó un método de detección más complejo con un modelo de detección de objetos que se conoce como \textit{YOLOv8} y se considera el estado del arte a la fecha.

\subsection{Detección de los estados fenológicos de la flor de duraznero}
 
La detección de flores ha sido estudiada con diferentes enfoques y arquitecturas de \textit{deep learning}, como por ejemplo el estudio \cite{ARTICLE:3} que exploró la viabilidad de detección de estados fenológicos de las rosas con técnicas del contraste del color y comparando con el modelo de detección \textit{Faster R-CNN}. Sin embargo, no utilizó ninguna arquitectura de una etapa para la detección, lo que podría ser más eficiente. Por otro lado, se tienen trabajos que sí utilizaron la arquitectura de una etapa, en específico de \textit{YOLO} en sus versiones 4 y 5 como se presenta en \cite{ARTICLE:4} \cite{ARTICLE:5}, pero su enfoque fue basado para las flores de kiwi.

La presente memoria busca en particular los estados fenológicos de la flor de duraznero utilizando y comparando dos modelos de detección, donde el primero tiene una arquitectura de dos etapas y el segundo tiene una arquitectura de una etapa. El detector de una etapa sería la arquitectura de \textit{YOLO} en su version 8, la cual se propuso para la realización efectiva y eficiente de esta tarea, además de representar el estado del arte en la actualidad.

\subsection{Conteo de flores}

El conteo de objetos en imágenes a través de visión por computadora es otro campo que ha sido altamente estudiado y tiene muchos enfoques tanto simples como complejos. De esta forma, se expone el caso \cite{ARTICLE:6} donde se hace uso de redes convolucionales para predecir mapas de densidad que permiten hacer un conteo preciso de objetos en imágenes de alta densidad. Así como también se tiene el trabajo \cite{ARTICLE:7} que utiliza \textit{transformers} con el mismo propósito.

Por otro lado, este trabajo propone una combinación entre el uso del modelo de detección de objetos y métodos de visión por computadora tradicionales para el conteo de las flores de duraznero.




%----------------------------------------------------------------------------------------

